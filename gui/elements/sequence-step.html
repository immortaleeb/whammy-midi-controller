<link rel="import"
      href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="whammy-mode-selector.html">

<dom-module id="sequence-step">
  <template>
    <style>
      .step {
        border: 1px solid black;
        display: block;
      }

      .right {
        float: right;
      }
    </style>

    <div id="step" class="step">
      <span id="delete-area" class="right"><a id="remove-step-button"><iron-icon icon="icons:close"></iron-icon></a></span>
      <p>Mode: <whammy-mode-selector selected-mode="{{step.mode}}"></whammy-mode-selector></p>
      
      <div id="show-treadle-level">
        <p><button id="show-treadle-level-button">Set treadle level</button></p>
      </div>

      <div id="set-treadle-level">
        <p>Treadle: <input type="range" min="0" max="128" value="{{step.treadleLevel::change}}"> {{step.treadleLevel}} <button id="clear-treadle-level-button">Clear</button></p>
      </div>
    </div>
  </template>
  <script>
    'use strict';

    (function() {
      Polymer({
        is: "sequence-step",

        properties: {
          step: Object,
          deleteable: {
            type: Boolean,
            observer: 'deleteableChanged'
          },
          active: {
            type: Boolean,
            observer: 'activeChanged'
          }
        },

        ready() {
          this.$['show-treadle-level-button'].addEventListener('click', () => { this.set('step.treadleLevel', 0) });
          this.$['clear-treadle-level-button'].addEventListener('click', () => { this.set('step.treadleLevel', undefined) });

          this.$['remove-step-button'].addEventListener('click', () => {
            this.fire('delete-step', { step: this.step });
          });
        },

        observers: ['treadleLevelChanged(step.treadleLevel)'],

        deleteableChanged(deleteable) {
          this.$['delete-area'].style.display = deleteable ? 'inline' : 'none';
        },

        treadleLevelChanged(treadleLevel) {
          // Change string values to integers
          if (typeof treadleLevel === 'string') {
            return this.set('step.treadleLevel', parseInt(treadleLevel));
          }

          if (typeof treadleLevel === 'undefined') {
            this.$['show-treadle-level'].style.display = 'block';
            this.$['set-treadle-level'].style.display = 'none';
          } else {
            this.$['show-treadle-level'].style.display = 'none';
            this.$['set-treadle-level'].style.display = 'block';
          }
        },

        activeChanged(isActive) {
          this.$.step.style.background = isActive ? '#C0C0C0' : 'white';
        }
      });
    }());
  </script>
</dom-module>
